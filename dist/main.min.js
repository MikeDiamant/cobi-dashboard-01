!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./modules/core"),e=a("./modules/view"),f=function(){function a(a,b,c){this.core=null,this.view=null,this.core=new d["default"],this.view=new e["default"](this.core,a,b,c)}return a.prototype.initView=function(){this.view.initView()},a.prototype.initAverageSpeedView=function(){this.view.initAverageSpeedView()},a.prototype.initAverageCadenceView=function(){this.view.initAverageCadenceView()},a.prototype.initSpeedCheck=function(){this.view.initSpeedCheck()},a.prototype.initCadenceCheck=function(){this.view.initCadenceCheck()},a.prototype.updateCurrentSpeedView=function(a){this.view.updateCurrentSpeedView(a)},a.prototype.updateCurrentCadenceView=function(a){this.view.updateCurrentCadenceView(a)},a.prototype.updateAverageSpeedView=function(a,b){void 0===b&&(b=!1),this.view.updateAverageSpeedView(a,b)},a.getVersion=function(){return this.version},a.version="0.1.1",a}();c.__esModule=!0,c["default"]=f},{"./modules/core":3,"./modules/view":4}],2:[function(a,b,c){var d=a("./dashboard"),e=new d["default"]("container",window.innerWidth,window.innerHeight);e.initView(),e.initAverageSpeedView(),e.initAverageCadenceView(),e.initSpeedCheck(),e.initCadenceCheck(),COBI.init("token â€” can by anything right now"),COBI.app.theme.subscribe(function(a){console.log(a)}),COBI.rideService.speed.subscribe(function(a){e.updateCurrentSpeedView(3.6*a)}),COBI.tourService.averageSpeed.subscribe(function(a){e.updateAverageSpeedView(3.6*a)}),COBI.rideService.cadenceAvailability.subscribe(function(a){console.log("cadence available: "+a)}),COBI.rideService.cadence.subscribe(function(a){e.updateCurrentCadenceView(a)})},{"./dashboard":1}],3:[function(a,b,c){var d=function(){function a(){this.localStorageAvailable=!1,this.maxSpeed=0,this.maxSpeedCeiling=20,this.maxSpeedCeilingBuffer=5,this.averageSpeed=0,this.averageSpeedMultiplier=10,this.maxCadence=0,this.maxCadenceCeiling=50,this.maxCadenceCeilingBuffer=10,this.averageCadence=0,this.averageCadenceMultiplier=100,this.localStorageAvailable="undefined"!=typeof Storage}return a.prototype.calculateSpeedBasedRotation=function(a){var b=100/this.maxSpeedCeiling*a;return 1.8*b},a.prototype.calculateCadenceBasedRotation=function(a){var b=100/this.maxCadenceCeiling*a;return 1.8*b},a.prototype.setAvrSpeed=function(b){null===this.averageSpeed&&(this.averageSpeed=b),b>0&&(b=(this.averageSpeed*(this.averageSpeedMultiplier-1)+b)/this.averageSpeedMultiplier,b=a.round(b),this.averageSpeed!==b&&(this.averageSpeed=b,this.storeItem("averageSpeed",this.averageSpeed)))},a.prototype.setAvrCadence=function(b){null===this.averageCadence&&(this.averageCadence=b),b>0&&(b=(this.averageCadence*(this.averageCadenceMultiplier-1)+b)/this.averageCadenceMultiplier,b=a.round(b),this.averageCadence!==b&&(this.averageCadence=b,this.storeItem("averageCadence",this.averageCadence)))},a.prototype.getAvrSpeed=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("averageSpeed");"undefined"!=typeof a&&(this.averageSpeed=a)}return this.averageSpeed},a.prototype.getAvrCadence=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("averageCadence");"undefined"!=typeof a&&(this.averageCadence=a)}return this.averageCadence},a.prototype.setMaxSpeed=function(b){b>this.maxSpeedCeiling&&(this.maxSpeed=a.round(b),this.maxSpeedCeiling=Math.ceil(this.maxSpeed/this.maxSpeedCeilingBuffer)*this.maxSpeedCeilingBuffer,this.maxSpeed===this.maxSpeedCeiling&&(this.maxSpeedCeiling+=5),this.storeItem("maxSpeed",this.maxSpeed),this.storeItem("maxSpeedCeiling",this.maxSpeedCeiling))},a.prototype.getMaxSpeed=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("maxSpeed");"undefined"!=typeof a&&(this.maxSpeed=a)}else this.maxSpeed=this.getAvrSpeed();return this.maxSpeed},a.prototype.getMaxSpeedCeiling=function(){return this.maxCadenceCeiling},a.prototype.setMaxCadence=function(b){b>this.maxCadenceCeiling&&(this.maxCadence=a.round(b),this.maxCadenceCeiling=Math.ceil(this.maxCadence/this.maxCadenceCeilingBuffer)*this.maxCadenceCeilingBuffer,this.maxCadence===this.maxCadenceCeiling&&(this.maxCadenceCeiling+=this.maxCadenceCeilingBuffer),this.storeItem("maxCadence",this.maxCadence),this.storeItem("maxCadenceCeiling",this.maxCadenceCeiling))},a.prototype.getMaxCadence=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("maxCadence");"undefined"!=typeof a&&(this.maxCadence=a)}else this.maxCadence=this.getAvrCadence();return this.maxCadence},a.prototype.getMaxCadenceCeiling=function(){return this.maxCadenceCeiling},a.round=function(a){return Math.round(10*a)/10},a.decimal=function(a){return a.toFixed(1)},a.prototype.storeItem=function(a,b){this.localStorageAvailable===!0&&localStorage.setItem(a,b)},a}();c.__esModule=!0,c["default"]=d},{}],4:[function(a,b,c){var d=a("./core"),e=a("../dashboard"),f=function(){function a(a,b,c,d){this.core=null,this.arcX=0,this.arcY=0,this.acrToBackground=5,this.checkSpeedInterval=1e3,this.checkSpeedIntervalObject=null,this.lastSpeedUpdate=0,this.averageCadenceInterval=1e3,this.averageCadenceIntervalObject=null,this.lastCadenceUpdate=0,this.checkCadenceInterval=1e3,this.checkCadenceIntervalObject=null,this.core=a,this.stageWidth=c,this.stageHeight=d,this.stageContainer=b,this.speedArcWidth=this.stageWidth/20,this.speedArcInnerRadius=this.stageWidth/2.5,this.speedArcOuterRadius=this.speedArcInnerRadius-this.speedArcWidth,this.cadenceArcInnerRadius=this.speedArcInnerRadius-55,this.cadenceArcOuterRadius=this.speedArcOuterRadius-25}return a.prototype.initView=function(){this.stage=new Konva.Stage({container:this.stageContainer,width:this.stageWidth,height:this.stageHeight}),this.arcX=this.stageWidth/2,this.arcY=this.stageHeight-.1*this.stageHeight,this.layer=new Konva.Layer,this.mask=new Konva.Group({clip:{x:0,y:0,width:this.stageWidth,height:this.arcY}}),this.speedArcBackground=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.speedArcInnerRadius+this.acrToBackground,outerRadius:this.speedArcOuterRadius-this.acrToBackground,angle:180,fill:"#444353",rotation:180}),this.curSpeedArc=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.speedArcInnerRadius,outerRadius:this.speedArcOuterRadius,angle:180,fill:"#00C8E6",shadowEnabled:!0,shadowBlur:10,shadowColor:"#00C8E6"}),this.averageSpeedArc=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.speedArcInnerRadius+this.acrToBackground+10,outerRadius:this.speedArcOuterRadius-this.acrToBackground,angle:2,opacity:.9,fill:"#FFF",shadowEnabled:!0,shadowBlur:10,shadowColor:"#FFF"}),this.averageCadenceArc=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.cadenceArcInnerRadius+this.acrToBackground,outerRadius:this.cadenceArcOuterRadius-this.acrToBackground,angle:2,opacity:.9,fill:"#FFF",shadowEnabled:!0,shadowBlur:10,shadowColor:"#FFF"}),this.cadenceArcBackground=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.cadenceArcInnerRadius+this.acrToBackground,outerRadius:this.cadenceArcOuterRadius-this.acrToBackground,angle:180,fill:"#444353",rotation:180}),this.curCadenceArc=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.cadenceArcInnerRadius,outerRadius:this.cadenceArcOuterRadius,angle:180,fill:"#00C8E6",shadowEnabled:!0,shadowBlur:10,shadowColor:"#00C8E6"});var a=this.stageWidth/1.1;this.bottomBar=new Konva.Shape({sceneFunc:function(b){var c=70,d=80,e=30;b.beginPath(),b.moveTo(0,c),b.quadraticCurveTo(d-e,0,d,0),b.lineTo(a,0),b.quadraticCurveTo(a+e,0,a+d,c),b.lineTo(0,c),b.closePath(),b.fillStrokeShape(this)},fill:"#FFF",x:-12,y:this.arcY}),this.speedDisplayFull=new Konva.Text({x:this.stageWidth/2.3,y:this.arcY-95,width:this.stageWidth/4,text:"0",fontSize:110,fontFamily:"UniSans",fill:"#fff",align:"right",shadowEnabled:!0,shadowBlur:5,shadowColor:"#fff"}),this.speedDisplayDecimal=new Konva.Text({x:this.stageWidth/2.3+this.stageWidth/4+15,y:this.arcY-55,width:this.stageWidth/5,text:"0",fontSize:50,fontFamily:"UniSans",fill:"#fff",align:"left",shadowEnabled:!0,shadowBlur:5,shadowColor:"#fff"}),this.mask.add(this.speedArcBackground),this.mask.add(this.cadenceArcBackground),this.mask.add(this.curSpeedArc),this.mask.add(this.averageSpeedArc),this.mask.add(this.curCadenceArc),this.mask.add(this.averageCadenceArc),this.layer.add(this.mask),this.layer.add(this.bottomBar),this.layer.add(this.speedDisplayFull),this.layer.add(this.speedDisplayDecimal),this.stage.add(this.layer),document.getElementById("version").innerHTML=e["default"].getVersion()},a.prototype.initAverageSpeedView=function(){this.core.setMaxSpeed(this.core.getMaxSpeed()),this.updateAverageSpeedView(this.core.getAvrSpeed(),!0)},a.prototype.initAverageCadenceView=function(){var a=this;this.core.setMaxCadence(this.core.getMaxCadence()),this.updateAverageCadenceView(this.core.getAvrCadence(),!0),null===this.averageCadenceIntervalObject&&(this.averageCadenceIntervalObject=setInterval(function(){a.updateAverageCadenceView(a.core.getAvrCadence(),!1)},this.averageCadenceInterval))},a.prototype.initSpeedCheck=function(){var a=this;null===this.checkSpeedIntervalObject&&(this.checkSpeedIntervalObject=setInterval(function(){(new Date).getTime()-a.lastSpeedUpdate>a.checkSpeedInterval&&a.updateCurrentSpeedView(0)},this.checkSpeedInterval))},a.prototype.initCadenceCheck=function(){var a=this;null===this.checkCadenceIntervalObject&&(this.checkCadenceIntervalObject=setInterval(function(){(new Date).getTime()-a.lastCadenceUpdate>a.checkCadenceInterval&&a.updateCurrentCadenceView(0)},this.checkCadenceInterval))},a.prototype.updateCurrentSpeedView=function(a){this.lastSpeedUpdate=(new Date).getTime(),a=d["default"].round(a);var b=d["default"].decimal(a).split(".");this.speedDisplayFull.text(b[0]),this.speedDisplayDecimal.text(b[1]),this.core.setMaxSpeed(a);var c=1;0===a&&(c=0);var e=new Konva.Tween({node:this.curSpeedArc,rotation:this.core.calculateSpeedBasedRotation(a),easing:Konva.Easings.EaseInOut,duration:.5,opacity:c});e.play(),document.getElementById("speed").innerHTML=d["default"].decimal(a)+" > "+this.core.getAvrSpeed()+" - ("+this.core.getMaxSpeed()+"/"+this.core.getMaxSpeedCeiling()+")"},a.prototype.updateCurrentCadenceView=function(a){this.lastCadenceUpdate=(new Date).getTime(),a=d["default"].round(a),this.core.setMaxCadence(a),this.core.setAvrCadence(a);var b=1;0===a&&(b=0);var c=new Konva.Tween({node:this.curCadenceArc,rotation:this.core.calculateCadenceBasedRotation(a),easing:Konva.Easings.EaseInOut,duration:.5,opacity:b});c.play(),document.getElementById("cadence").innerHTML=d["default"].decimal(a)+" > "+this.core.getAvrCadence()+" - ("+this.core.getMaxCadence()+"/"+this.core.getMaxCadenceCeiling()+")"},a.prototype.updateAverageSpeedView=function(a,b){void 0===b&&(b=!1),a=d["default"].round(a),this.core.setAvrSpeed(a);var c=.5;b===!0&&(c=5);var e=0;0!==a&&(e=this.core.calculateSpeedBasedRotation(a)+180);var f=new Konva.Tween({node:this.averageSpeedArc,rotation:e,easing:Konva.Easings.EaseInOut,duration:c});f.play()},a.prototype.updateAverageCadenceView=function(a,b){void 0===b&&(b=!1),a=d["default"].round(a),this.core.setAvrCadence(a);var c=.5;b===!0&&(c=5);var e=0;0!==a&&(e=this.core.calculateCadenceBasedRotation(a)+180);var f=new Konva.Tween({node:this.averageCadenceArc,rotation:e,easing:Konva.Easings.EaseInOut,duration:c});f.play()},a}();c.__esModule=!0,c["default"]=f},{"../dashboard":1,"./core":3}]},{},[2]);
//# sourceMappingURL=main.min.js.map
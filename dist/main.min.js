!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./modules/view"),e=function(){function a(a,b,c){this.version="0.0.7",this.localStorageAvailable=!1,this.arcX=0,this.arcY=0,this.acrToBackground=5,this.maxSpeed=0,this.maxSpeedCeiling=20,this.maxSpeedCeilingBufer=5,this.averageSpeed=0,this.averageSpeedMultiplier=10,this.checkSpeedInterval=1e3,this.checkSpeedIntervalObject=null,this.lastSpeedUpdate=0,this.maxCadence=0,this.maxCadenceCeiling=50,this.maxCadenceCeilingBuffer=10,this.averageCadence=0,this.averageCadenceMultiplier=100,this.averageCadenceInterval=1e3,this.averageCadenceIntervalObject=null,this.lastCadenceUpdate=0,this.checkCadenceInterval=1e3,this.checkCadenceIntervalObject=null;new d["default"];this.localStorageAvailable="undefined"!=typeof Storage,this.stageWidth=b,this.stageHeight=c,this.stageContainer=a,this.speedArcWidth=this.stageWidth/20,this.speedArcInnerRadius=this.stageWidth/2.5,this.speedArcOuterRadius=this.speedArcInnerRadius-this.speedArcWidth,this.cadenceArcInnerRadius=this.speedArcInnerRadius-55,this.cadenceArcOuterRadius=this.speedArcOuterRadius-25}return a.prototype.initView=function(){this.stage=new Konva.Stage({container:this.stageContainer,width:this.stageWidth,height:this.stageHeight}),this.arcX=this.stageWidth/2,this.arcY=this.stageHeight-.1*this.stageHeight,this.layer=new Konva.Layer,this.mask=new Konva.Group({clip:{x:0,y:0,width:this.stageWidth,height:this.arcY}}),this.speedArcBackground=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.speedArcInnerRadius+this.acrToBackground,outerRadius:this.speedArcOuterRadius-this.acrToBackground,angle:180,fill:"#444353",rotation:180}),this.curSpeedArc=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.speedArcInnerRadius,outerRadius:this.speedArcOuterRadius,angle:180,fill:"#00C8E6",shadowEnabled:!0,shadowBlur:10,shadowColor:"#00C8E6"}),this.averageSpeedArc=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.speedArcInnerRadius+this.acrToBackground+10,outerRadius:this.speedArcOuterRadius-this.acrToBackground,angle:2,opacity:.9,fill:"#FFF",shadowEnabled:!0,shadowBlur:10,shadowColor:"#FFF"}),this.averageCadenceArc=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.cadenceArcInnerRadius+this.acrToBackground,outerRadius:this.cadenceArcOuterRadius-this.acrToBackground,angle:2,opacity:.9,fill:"#FFF",shadowEnabled:!0,shadowBlur:10,shadowColor:"#FFF"}),this.cadenceArcBackground=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.cadenceArcInnerRadius+this.acrToBackground,outerRadius:this.cadenceArcOuterRadius-this.acrToBackground,angle:180,fill:"#444353",rotation:180}),this.curCadenceArc=new Konva.Arc({x:this.arcX,y:this.arcY,innerRadius:this.cadenceArcInnerRadius,outerRadius:this.cadenceArcOuterRadius,angle:180,fill:"#00C8E6",shadowEnabled:!0,shadowBlur:10,shadowColor:"#00C8E6"});var a=this.stageWidth/1.1;this.bottomBar=new Konva.Shape({sceneFunc:function(b){var c=70,d=80,e=30;b.beginPath(),b.moveTo(0,c),b.quadraticCurveTo(d-e,0,d,0),b.lineTo(a,0),b.quadraticCurveTo(a+e,0,a+d,c),b.lineTo(0,c),b.closePath(),b.fillStrokeShape(this)},fill:"#FFF",x:-12,y:this.arcY}),this.mask.add(this.speedArcBackground),this.mask.add(this.cadenceArcBackground),this.mask.add(this.curSpeedArc),this.mask.add(this.averageSpeedArc),this.mask.add(this.curCadenceArc),this.mask.add(this.averageCadenceArc),this.layer.add(this.mask),this.layer.add(this.bottomBar),this.stage.add(this.layer),document.getElementById("version").innerHTML=this.version},a.prototype.initAverageSpeedView=function(){this.setMaxSpeed(this.getMaxSpeed()),this.updateAverageSpeedView(this.getAvrSpeed(),!0)},a.prototype.initAverageCadenceView=function(){var a=this;this.setMaxCadence(this.getMaxCadence()),this.updateAverageCadenceView(this.getAvrCadence(),!0),null===this.averageCadenceIntervalObject&&(this.averageCadenceIntervalObject=setInterval(function(){a.updateAverageCadenceView(a.getAvrCadence(),!1)},this.averageCadenceInterval))},a.prototype.initSpeedCheck=function(){var a=this;null===this.checkSpeedIntervalObject&&(this.checkSpeedIntervalObject=setInterval(function(){(new Date).getTime()-a.lastSpeedUpdate>a.checkSpeedInterval&&a.updateCurrentSpeedView(0)},this.checkSpeedInterval))},a.prototype.initCadenceCheck=function(){var a=this;null===this.checkCadenceIntervalObject&&(this.checkCadenceIntervalObject=setInterval(function(){(new Date).getTime()-a.lastCadenceUpdate>a.checkCadenceInterval&&a.updateCurrentCadenceView(0)},this.checkCadenceInterval))},a.prototype.updateCurrentSpeedView=function(a){this.lastSpeedUpdate=(new Date).getTime(),a=this.round(a),this.setMaxSpeed(a);var b=1;0===a&&(b=0);var c=new Konva.Tween({node:this.curSpeedArc,rotation:this.calculateSpeedBasedRotation(a),easing:Konva.Easings.EaseInOut,duration:.5,opacity:b});c.play(),document.getElementById("speed").innerHTML=a+" > "+this.averageSpeed+" - ("+this.maxSpeed+"/"+this.maxSpeedCeiling+")"},a.prototype.updateCurrentCadenceView=function(a){this.lastCadenceUpdate=(new Date).getTime(),a=this.round(a),this.setMaxCadence(a),this.setAvrCadence(a);var b=1;0===a&&(b=0);var c=new Konva.Tween({node:this.curCadenceArc,rotation:this.calculateCadenceBasedRotation(a),easing:Konva.Easings.EaseInOut,duration:.5,opacity:b});c.play(),document.getElementById("cadence").innerHTML=a+" > "+this.averageCadence+" - ("+this.maxCadence+"/"+this.maxCadenceCeiling+")"},a.prototype.updateAverageSpeedView=function(a,b){void 0===b&&(b=!1),a=this.round(a),this.setAvrSpeed(a);var c=.5;b===!0&&(c=5);var d=0;0!==a&&(d=this.calculateSpeedBasedRotation(a)+180);var e=new Konva.Tween({node:this.averageSpeedArc,rotation:d,easing:Konva.Easings.EaseInOut,duration:c});e.play()},a.prototype.updateAverageCadenceView=function(a,b){void 0===b&&(b=!1),a=this.round(a),this.setAvrCadence(a);var c=.5;b===!0&&(c=5);var d=0;0!==a&&(d=this.calculateCadenceBasedRotation(a)+180);var e=new Konva.Tween({node:this.averageCadenceArc,rotation:d,easing:Konva.Easings.EaseInOut,duration:c});e.play()},a.prototype.calculateSpeedBasedRotation=function(a){var b=100/this.maxSpeedCeiling*a;return 1.8*b},a.prototype.calculateCadenceBasedRotation=function(a){var b=100/this.maxCadenceCeiling*a;return 1.8*b},a.prototype.setAvrSpeed=function(a){null===this.averageSpeed&&(this.averageSpeed=a),a>0&&(a=(this.averageSpeed*(this.averageSpeedMultiplier-1)+a)/this.averageSpeedMultiplier,a=this.round(a),this.averageSpeed!==a&&(this.averageSpeed=a,this.storeItem("averageSpeed",this.averageSpeed)))},a.prototype.setAvrCadence=function(a){null===this.averageCadence&&(this.averageCadence=a),a>0&&(a=(this.averageCadence*(this.averageCadenceMultiplier-1)+a)/this.averageCadenceMultiplier,a=this.round(a),this.averageCadence!==a&&(this.averageCadence=a,this.storeItem("averageCadence",this.averageCadence)))},a.prototype.getAvrSpeed=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("averageSpeed");"undefined"!=typeof a&&(this.averageSpeed=a)}return this.averageSpeed},a.prototype.getAvrCadence=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("averageCadence");"undefined"!=typeof a&&(this.averageCadence=a)}return this.averageCadence},a.prototype.setMaxSpeed=function(a){a>this.maxSpeedCeiling&&(this.maxSpeed=this.round(a),this.maxSpeedCeiling=Math.ceil(this.maxSpeed/this.maxSpeedCeilingBufer)*this.maxSpeedCeilingBufer,this.maxSpeed===this.maxSpeedCeiling&&(this.maxSpeedCeiling+=5),this.storeItem("maxSpeed",this.maxSpeed),this.storeItem("maxSpeedCeiling",this.maxSpeedCeiling))},a.prototype.getMaxSpeed=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("maxSpeed");"undefined"!=typeof a&&(this.maxSpeed=a)}else this.maxSpeed=this.getAvrSpeed();return this.maxSpeed},a.prototype.setMaxCadence=function(a){a>this.maxCadenceCeiling&&(this.maxCadence=this.round(a),this.maxCadenceCeiling=Math.ceil(this.maxCadence/this.maxCadenceCeilingBuffer)*this.maxCadenceCeilingBuffer,this.maxCadence===this.maxCadenceCeiling&&(this.maxCadenceCeiling+=this.maxCadenceCeilingBuffer),this.storeItem("maxCadence",this.maxCadence),this.storeItem("maxCadenceCeiling",this.maxCadenceCeiling))},a.prototype.getMaxCadence=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("maxCadence");"undefined"!=typeof a&&(this.maxCadence=a)}else this.maxCadence=this.getAvrCadence();return this.maxCadence},a.prototype.round=function(a){return Math.round(10*a)/10},a.prototype.storeItem=function(a,b){this.localStorageAvailable===!0&&localStorage.setItem(a,b)},a}();c.__esModule=!0,c["default"]=e},{"./modules/view":3}],2:[function(a,b,c){var d=a("./bkDashboard");COBI.init("token â€” can by anything right now");var e=new d["default"]("container",window.innerWidth,window.innerHeight);e.initView(),e.initAverageSpeedView(),e.initAverageCadenceView(),e.initSpeedCheck(),e.initCadenceCheck(),COBI.app.theme.subscribe(function(a){console.log(a)}),COBI.rideService.speed.subscribe(function(a){e.updateCurrentSpeedView(3.6*a)}),COBI.tourService.averageSpeed.subscribe(function(a){e.updateAverageSpeedView(3.6*a)}),COBI.rideService.cadenceAvailability.subscribe(function(a){console.log("cadence available: "+a)}),COBI.rideService.cadence.subscribe(function(a){e.updateCurrentCadenceView(a)})},{"./bkDashboard":1}],3:[function(a,b,c){var d=function(){function a(){}return a}();c.__esModule=!0,c["default"]=d},{}]},{},[2]);
//# sourceMappingURL=main.min.js.map